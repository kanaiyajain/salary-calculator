<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salary Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .input-label {
            @apply block text-sm font-medium text-gray-700 mb-1;
        }
        .input-field {
            @apply block w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-2.5;
        }
        .input-field-readonly {
            @apply block w-full bg-gray-200 border border-gray-300 text-gray-700 text-sm rounded-lg p-2.5 cursor-not-allowed;
        }
        .output-field {
            @apply text-lg font-semibold text-gray-900;
        }
        .output-label {
            @apply text-sm font-medium text-gray-500;
        }
        .card {
            @apply bg-white p-6 rounded-xl shadow-lg;
        }
        .final-amount {
            @apply text-3xl font-bold text-blue-600;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-7xl mx-auto">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Advanced Salary Calculator</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            
            <!-- Left Column: Main Inputs & Daily Tracker -->
            <div class="md:col-span-2 space-y-6">
                <div class="card">
                    <h2 class="text-xl font-semibold text-gray-800 border-b pb-2 mb-4">Employee & Salary Details</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
                        <!-- Basic Inputs -->
                        <div class="sm:col-span-1">
                            <label for="name" class="input-label">Name</label>
                            <input type="text" id="name" class="input-field" placeholder="Input Name">
                        </div>
                        <div>
                            <label for="daysInMonth" class="input-label">Month Days</label>
                            <select id="daysInMonth" class="input-field">
                                <option value="31">31</option>
                                <option value="30">30</option>
                                <option value="29">29</option>
                                <option value="28">28</option>
                            </select>
                        </div>
                         <div>
                            <label for="officeLeave" class="input-label">Office Leave (Days)</label>
                            <input type="number" id="officeLeave" class="input-field" placeholder="0" value="0">
                        </div>
                        <div>
                            <label for="basicSalary" class="input-label">Basic Salary</label>
                            <input type="number" id="basicSalary" class="input-field" placeholder="0" value="0">
                        </div>
                        <div>
                            <label for="additionalPayout" class="input-label">Additional Payout</label>
                            <select id="additionalPayout" class="input-field">
                                <option value="0">0</option>
                                <option value="500">500</option>
                                <option value="1500">1500</option>
                            </select>
                        </div>

                        <!-- Attendance Inputs -->
                        <div class="sm:col-span-3 mt-4">
                             <h3 class="text-lg font-semibold text-gray-700 border-b pb-2 mb-4">Attendance & Leave Calculation</h3>
                        </div>
                        <div>
                            <label for="presentDays" class="input-label">Present Days</label>
                            <input type="number" id="presentDays" class="input-field" placeholder="e.g., 25" value="31">
                             <p class="text-xs text-gray-500 mt-1">Days with >= 9 hours work.</p>
                        </div>
                         <div>
                            <label for="lateIns" class="input-label">Total Late-ins</label>
                            <input type="number" id="lateIns" class="input-field" placeholder="0" value="0">
                             <p class="text-xs text-gray-500 mt-1">Leave deduction auto-calculated.</p>
                        </div>
                         <div>
                            <label for="shortDurationPenaltyDays" class="input-label">Short Duration Days (Penalty)</label>
                            <input type="number" id="shortDurationPenaltyDays" class="input-field-readonly" value="0" readonly>
                            <p class="text-xs text-gray-500 mt-1">Auto-calculated from daily minutes.</p>
                        </div>
                        <div>
                            <label for="continuousLatePenaltyDays" class="input-label">3 Continue Late-in (Instances)</label>
                            <input type="number" id="continuousLatePenaltyDays" class="input-field" placeholder="0" value="0">
                             <p class="text-xs text-gray-500 mt-1">Deducts 0.5 day per instance.</p>
                        </div>
                        <div>
                            <label for="noInformLeave" class="input-label">No-inform Leave (Instances)</label>
                            <input type="number" id="noInformLeave" class="input-field" placeholder="0" value="0">
                            <p class="text-xs text-gray-500 mt-1">Deducts 0.5 day per instance.</p>
                        </div>
                         <div>
                            <label for="allowedLeaveCredit" class="input-label">Allowed Leave (Credit)</label>
                            <input type="number" id="allowedLeaveCredit" class="input-field-readonly" value="0" readonly>
                             <p class="text-xs text-gray-500 mt-1">Auto-calculated from Present Days.</p>
                        </div>

                        <!-- Bonus Inputs -->
                         <div class="sm:col-span-3 mt-4">
                             <h3 class="text-lg font-semibold text-gray-700 border-b pb-2 mb-4">Bonus & Other Adjustments</h3>
                        </div>
                        <div>
                            <label for="bonusScale" class="input-label">Bonus Scale</label>
                            <select id="bonusScale" class="input-field">
                                <option value="1">100%</option>
                                <option value="0.5">50%</option>
                                <option value="0">0%</option>
                            </select>
                        </div>
                        <div>
                            <label for="noLeaveBonus" class="input-label">No Leave Bonus</label>
                            <input type="text" id="noLeaveBonus" class="input-field-readonly" value="₹0.00" readonly>
                        </div>
                         <div>
                            <label for="noLateInBonus" class="input-label">No Late-in Bonus</label>
                            <input type="text" id="noLateInBonus" class="input-field-readonly" value="₹0.00" readonly>
                        </div>
                         <div>
                            <label for="anyOther" class="input-label">Any Other (Bonus/Deduction)</label>
                            <input type="number" id="anyOther" class="input-field" placeholder="0" value="0">
                        </div>
                        <div>
                            <label for="top3" class="input-label">Top 3 Bonus</label>
                            <input type="number" id="top3" class="input-field" placeholder="0" value="0">
                        </div>
                    </div>
                </div>
                 <div class="card">
                    <h2 class="text-xl font-semibold text-gray-800 border-b pb-2 mb-4">Daily Short Duration</h2>
                    <div>
                        <label for="dailyWorkingTime" class="input-label">Daily Working Time</label>
                        <select id="dailyWorkingTime" class="input-field mb-4">
                            <option value="540">9 Hours</option>
                            <option value="360">6 Hours</option>
                            <option value="270">4.5 Hours</option>
                        </select>
                    </div>
                    <div id="dailyMinutesContainer" class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-5 gap-x-4 gap-y-2 max-h-64 overflow-y-auto pr-2">
                        <!-- JS will populate this -->
                    </div>
                     <div class="flex justify-between items-center mt-4 pt-2 border-t">
                            <span class="output-label">Total Short Minutes</span>
                            <span id="totalShortMinutes" class="output-field">0</span>
                        </div>
                </div>
            </div>

            <!-- Right Column: Summary -->
            <div class="md:col-span-1 space-y-6">
                <div class="card">
                    <h2 class="text-xl font-semibold text-gray-800 border-b pb-2 mb-4">Calculation Summary</h2>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="output-label">Total Salary</span>
                            <span id="totalSalary" class="output-field">₹0.00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="output-label">Active Days</span>
                            <span id="activeDays" class="output-field">31</span>
                        </div>
                        <hr/>
                        <div class="flex justify-between items-center">
                            <span class="output-label text-red-600">Short Duration (Days)</span>
                            <span id="summaryShortDuration" class="output-field text-red-600">-0.00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="output-label text-red-600">Late-in Leave (Days)</span>
                            <span id="summaryLateIn" class="output-field text-red-600">-0.00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="output-label text-red-600">3 Continue Late-in (Days)</span>
                            <span id="summaryContinuousLate" class="output-field text-red-600">-0.00</span>
                        </div>
                         <div class="flex justify-between items-center">
                            <span class="output-label text-red-600">No-inform Leave (Days)</span>
                            <span id="summaryNoInform" class="output-field text-red-600">-0.00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="output-label text-green-600">Allowed Leave (Credit)</span>
                            <span id="summaryAllowedLeave" class="output-field text-green-600">+0.00</span>
                        </div>
                        <hr/>
                        <div class="flex justify-between items-center">
                            <span class="output-label font-bold">Payable Days</span>
                            <span id="payableDays" class="output-field font-bold text-blue-600">0.00</span>
                        </div>
                        <hr/>
                         <div class="flex justify-between items-center">
                            <span class="output-label">Salary Payable</span>
                            <span id="salaryPayable" class="output-field">₹0.00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="output-label text-green-600">No Leave Bonus</span>
                            <span id="summaryNoLeaveBonus" class="output-field text-green-600">+ ₹0.00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="output-label text-green-600">No Late-in Bonus</span>
                            <span id="summaryNoLateInBonus" class="output-field text-green-600">+ ₹0.00</span>
                        </div>
                        <hr/>
                        <div class="text-center mt-4 bg-blue-50 p-4 rounded-lg">
                            <span class="output-label">Final Amount Payable</span>
                            <p id="finalAmountPayable" class="final-amount">₹0.00</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- DOM Element References ---
            const inputs = {
                basicSalary: document.getElementById('basicSalary'),
                additionalPayout: document.getElementById('additionalPayout'),
                daysInMonth: document.getElementById('daysInMonth'),
                officeLeave: document.getElementById('officeLeave'),
                presentDays: document.getElementById('presentDays'),
                shortDurationPenaltyDays: document.getElementById('shortDurationPenaltyDays'),
                lateIns: document.getElementById('lateIns'),
                continuousLatePenaltyDays: document.getElementById('continuousLatePenaltyDays'),
                noInformLeave: document.getElementById('noInformLeave'),
                allowedLeaveCredit: document.getElementById('allowedLeaveCredit'),
                bonusScale: document.getElementById('bonusScale'),
                noLeaveBonus: document.getElementById('noLeaveBonus'),
                noLateInBonus: document.getElementById('noLateInBonus'),
                anyOther: document.getElementById('anyOther'),
                top3: document.getElementById('top3'),
                dailyWorkingTime: document.getElementById('dailyWorkingTime'),
            };

            const outputs = {
                totalSalary: document.getElementById('totalSalary'),
                activeDays: document.getElementById('activeDays'),
                payableDays: document.getElementById('payableDays'),
                salaryPayable: document.getElementById('salaryPayable'),
                finalAmountPayable: document.getElementById('finalAmountPayable'),
                totalShortMinutes: document.getElementById('totalShortMinutes'),
                summaryShortDuration: document.getElementById('summaryShortDuration'),
                summaryLateIn: document.getElementById('summaryLateIn'),
                summaryContinuousLate: document.getElementById('summaryContinuousLate'),
                summaryNoInform: document.getElementById('summaryNoInform'),
                summaryAllowedLeave: document.getElementById('summaryAllowedLeave'),
                summaryNoLeaveBonus: document.getElementById('summaryNoLeaveBonus'),
                summaryNoLateInBonus: document.getElementById('summaryNoLateInBonus'),
            };
            
            const dailyMinutesContainer = document.getElementById('dailyMinutesContainer');

            // --- Helper Functions ---
            const formatCurrency = (value) => `₹${(value || 0).toFixed(2)}`;
            const getNumberValue = (element) => parseFloat(element.value) || 0;

            // --- Core Calculation Logic ---
            function calculateSalary() {
                // 1. Get all input values
                const basicSalary = getNumberValue(inputs.basicSalary);
                const additionalPayout = getNumberValue(inputs.additionalPayout);
                const daysInMonth = getNumberValue(inputs.daysInMonth);
                const officeLeave = getNumberValue(inputs.officeLeave);
                const presentDays = getNumberValue(inputs.presentDays);
                const lateIns = getNumberValue(inputs.lateIns);
                const continuousLateInstances = getNumberValue(inputs.continuousLatePenaltyDays);
                const noInformLeaveInstances = getNumberValue(inputs.noInformLeave);
                const bonusScale = getNumberValue(inputs.bonusScale);
                const anyOther = getNumberValue(inputs.anyOther);
                const top3 = getNumberValue(inputs.top3);
                const dailyWorkingTimeMins = getNumberValue(inputs.dailyWorkingTime);

                // 2. Perform calculations based on new logic
                
                // Total Salary = Basic + Additional
                const totalSalary = basicSalary + additionalPayout;

                // Active Days = Month Days - Office Leave
                const calculatedActiveDays = daysInMonth - officeLeave;

                // --- Calculate all penalties and credits ---
                const totalShortMinutes = calculateTotalShortMinutes();
                const shortDurationPenaltyDays = dailyWorkingTimeMins > 0 ? totalShortMinutes / dailyWorkingTimeMins : 0;
                inputs.shortDurationPenaltyDays.value = shortDurationPenaltyDays.toFixed(2);

                let lateInLeaveDeductionDays = 0;
                if (lateIns > 15) lateInLeaveDeductionDays = Math.ceil(lateIns / 5);
                else if (lateIns >= 9) lateInLeaveDeductionDays = 1;
                else if (lateIns >= 5) lateInLeaveDeductionDays = 0.5;

                const continuousLatePenalty = continuousLateInstances * 0.5;
                const noInformLeavePenalty = noInformLeaveInstances * 0.5;

                let allowedLeaveCredit = 0;
                if (presentDays >= 25) allowedLeaveCredit = 3;
                else if (presentDays >= 20) allowedLeaveCredit = 2;
                else if (presentDays >= 14) allowedLeaveCredit = 1;
                inputs.allowedLeaveCredit.value = allowedLeaveCredit;

                // --- Calculate Bonus Applicable Days (for bonus check) ---
                const totalDeductions = shortDurationPenaltyDays + lateInLeaveDeductionDays + continuousLatePenalty + noInformLeavePenalty;
                const bonusApplicableDays = calculatedActiveDays - totalDeductions;
                
                // --- Calculate Final Payable Days ---
                let payableDays = bonusApplicableDays + allowedLeaveCredit;

                // Cap payable days at the number of *month* days
                if (payableDays > daysInMonth) {
                    payableDays = daysInMonth;
                }
                if (payableDays < 0) {
                    payableDays = 0;
                }

                // --- Calculate Salary Payable ---
                const perDaySalary = daysInMonth > 0 ? totalSalary / daysInMonth : 0;
                const salaryPayable = perDaySalary * payableDays;
                
                // --- Auto-calculate Bonuses based on Bonus Applicable Days ---
                const dayDifference = calculatedActiveDays - bonusApplicableDays;
                const noLeaveBonusValue = (dayDifference <= 1 && calculatedActiveDays > 0) ? 500 * bonusScale : 0;
                inputs.noLeaveBonus.value = formatCurrency(noLeaveBonusValue);
                
                const noLateInBonusValue = (lateIns <= 3) ? 400 * bonusScale : 0;
                inputs.noLateInBonus.value = formatCurrency(noLateInBonusValue);

                // --- Calculate Final Amount ---
                const finalAmountPayable = salaryPayable + noLeaveBonusValue + noLateInBonusValue + anyOther + top3;

                // 3. Update the UI
                outputs.totalSalary.textContent = formatCurrency(totalSalary);
                outputs.activeDays.textContent = calculatedActiveDays;
                
                // Update summary breakdown
                outputs.summaryShortDuration.textContent = `-${shortDurationPenaltyDays.toFixed(2)}`;
                outputs.summaryLateIn.textContent = `-${lateInLeaveDeductionDays.toFixed(2)}`;
                outputs.summaryContinuousLate.textContent = `-${continuousLatePenalty.toFixed(2)}`;
                outputs.summaryNoInform.textContent = `-${noInformLeavePenalty.toFixed(2)}`;
                outputs.summaryAllowedLeave.textContent = `+${allowedLeaveCredit.toFixed(2)}`;
                
                outputs.payableDays.textContent = payableDays.toFixed(2);
                outputs.salaryPayable.textContent = formatCurrency(salaryPayable);

                outputs.summaryNoLeaveBonus.textContent = `+ ${formatCurrency(noLeaveBonusValue)}`;
                outputs.summaryNoLateInBonus.textContent = `+ ${formatCurrency(noLateInBonusValue)}`;

                outputs.finalAmountPayable.textContent = formatCurrency(finalAmountPayable);
            }
            
            function calculateTotalShortMinutes() {
                const minuteInputs = dailyMinutesContainer.querySelectorAll('input');
                let total = 0;
                minuteInputs.forEach(input => {
                    total += getNumberValue(input);
                });
                outputs.totalShortMinutes.textContent = total;
                return total;
            }

            // --- Dynamic Day Inputs Generation ---
            function generateDayInputs() {
                dailyMinutesContainer.innerHTML = ''; // Clear existing inputs
                const daysInMonth = getNumberValue(inputs.daysInMonth);
                for (let i = 1; i <= 31; i++) {
                    const dayWrapper = document.createElement('div');
                    dayWrapper.className = 'flex items-center space-x-2';
                    if (i > daysInMonth) {
                        dayWrapper.style.display = 'none';
                    }
                    
                    const label = document.createElement('label');
                    label.className = 'text-sm text-gray-600 w-10';
                    label.textContent = `Day ${i}`;
                    
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.className = 'input-field w-20 text-center p-1';
                    input.placeholder = 'mins';
                    input.addEventListener('input', calculateSalary);
                    
                    dayWrapper.appendChild(label);
                    dayWrapper.appendChild(input);
                    dailyMinutesContainer.appendChild(dayWrapper);
                }
            }
            
            function toggleDayInputsVisibility() {
                 const daysInMonth = getNumberValue(inputs.daysInMonth);
                 const allDayInputs = dailyMinutesContainer.children;
                 for(let i = 0; i < allDayInputs.length; i++) {
                     allDayInputs[i].style.display = i < daysInMonth ? 'flex' : 'none';
                 }
            }

            // --- Event Listeners ---
            Object.values(inputs).forEach(input => {
                if (!input.readOnly) {
                    input.addEventListener('input', calculateSalary);
                }
            });
            
            inputs.daysInMonth.addEventListener('change', () => {
                toggleDayInputsVisibility();
                calculateSalary();
            });

            // --- Initial Setup ---
            generateDayInputs();
            calculateSalary(); // Initial calculation on page load
        });
    </script>
</body>
</html>
